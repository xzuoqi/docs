import { Image } from "@site/src/utils/docs";

介绍如何在 MicroSD 卡启动系统正常的情况下，使用 `dd` 命令将系统安装到 NVMe SSD 中。

:::warning
安装系统会格式化 NVMe SSD，如果有重要数据请提前备份！
:::

## 使用前提

您需要满足以下条件才可以使用 `dd` 命令将系统安装到 NVMe SSD 中：

- 系统可以通过 MicroSD 卡正常启动系统

- NVMe 安装到主板上

## 硬件连接

将 NVMe SSD 安装到主板上，连接显示器，使用电源适配器给主板供电。

<Tabs queryString="system boot">
  <TabItem value="M.2 M 2280 接口" default={props.tag === "m2_2280"} attributes={{ className: props.tag !== "m2_2280" ? "tab_none" : "" }}>
    通过 M.2 M Key 2280 接口安装 NVMe SSD。
    <div style={{ textAlign: "center" }}>
      <img
        src="/img/common/radxa-os/install-system/nvme-m2-2280.webp"
        style={{ width: "100%", maxWidth: "1200px" }}
      />
    </div>
  </TabItem>

<TabItem
  value="M.2 M 2230 接口"
  default={props.tag === "m2_2230"}
  attributes={{ className: props.tag !== "m2_2230" ? "tab_none" : "" }}
>
  通过 M.2 M Key 2230 接口安装 NVMe SSD。
  <Image
    src="/img/common/radxa-os/install-system/radxa-#board#-nvme-ssd.webp"
    board={props.board}
    fallback={props.board}
    width="1200"
  />
</TabItem>

  <TabItem value="PCIe FPC 接口" default={props.tag === "pcie_fpc"} attributes={{className: props.tag !== "pcie_fpc" ? "tab_none" : ""}}>
    通过 PCIe FPC 接口搭配 M.2 M Key HAT 可以安装 NVMe SSD。
  </TabItem>
</Tabs>

## 安装系统

### 下载系统镜像

主板需要访问 <a href={props?.download_page ?? '../../../../download'}>资源汇总下载</a> 页面，下载 **最新系统镜像** 到主板上。

:::tip 镜像说明
下载的系统镜像是压缩文件，需要解压后才能使用！
:::

您可以使用 `wget` 命令下载系统镜像文件到主板上。

<NewCodeBlock tip={`radxa@${props?.board ?? 'device'}$`} type="device">

```
sudo apt update
sudo apt install wget -y
wget <download_url>
```

</NewCodeBlock>

其中 `<download_url>` 为系统镜像文件的下载地址，可以复制 <a href={props?.download_page ?? '../../../../download'}>资源汇总下载</a> 页面中的 **最新镜像** 下载地址进行替换。

下载示例：

<code>{`wget ${props?.download_url ?? "<download_url>"}`}</code>

#### 解压系统镜像

我们的系统镜像一般为 `*.img.xz` 格式，需要解压后才能使用。

<NewCodeBlock tip={`radxa@${props?.board ?? 'device'}$`} type="device">

```
sudo apt install xz-utils -y
unxz <path_to_image_unxz>
```

</NewCodeBlock>

其中 `<path_to_image_unxz>` 为系统镜像文件的路径，需要替换成实际的系统镜像文件路径。

解压示例：

<code>{`unxz ${props?.path_to_image_unxz ?? "<path_to_image_unxz>"}`}</code>

### 确定设备路径

可以使用 `lsblk` 命令查看设备路径，根据磁盘的容量来确定设备路径。

说明：若是磁盘容量接近一致，可以安全插拔（适用于 NVMe SSD）来观察出现和消失的设备路径，从而确定设备路径。

<NewCodeBlock tip={`radxa@${props?.board ?? 'device'}$`} type="device">

```
lsblk
```

</NewCodeBlock>

系统若识别出 NVMe 设备，通常会识别成 `/dev/nvme*n*` 设备，若有多个存储设备，可以通过安全插拔设备判断对应设备路径。

终端输出示例:

```
NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
···
nvme0n1     259:0    0 119.2G  0 disk
└─nvme0n1p1 259:1    0 119.2G  0 part
···
```

### 安装系统镜像

使用 `dd` 命令将系统镜像安装到 NVMe SSD 中。

<NewCodeBlock tip={`radxa@${props?.board ?? 'device'}$`} type="device">

```
sudo dd if=<path_to_image> of=<device_target> bs=4M status=progress
```

</NewCodeBlock>

写入示例：

<code>{`sudo dd if=${
  props?.path_to_image ?? "<path_to_image>"
} of=/dev/nvme0n1 bs=4M status=progress`}</code>

参数说明：

- `<path_to_image>`：系统镜像文件的路径，需要替换成实际的系统镜像文件路径。

- `<device_target>`：NVMe SSD 模块的设备路径，需要替换成实际的 NVMe SSD 模块的设备路径。

- `bs=4M`：写入块大小。

- `status=progress`：显示写入进度。

### 验证写入结果

安装系统完成后，可以通过 `lsblk` 命令查看 NVMe SSD 的分区表是否正常创建。

<NewCodeBlock tip={`radxa@${props?.board ?? 'device'}$`} type="device">

```
lsblk
```

</NewCodeBlock>

终端输出示例:

```
NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
···
nvme0n1     259:0    0 119.2G  0 disk
├─nvme0n1p1 259:3    0    16M  0 part
├─nvme0n1p2 259:4    0   300M  0 part
└─nvme0n1p3 259:5    0   6.3G  0 part
···
```
